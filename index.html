<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feliz Navidad!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body { 
            margin: 0; 
            background-color: #050505; 
            font-family: 'Mountains of Christmas', cursive;
            overflow-x: hidden;
            -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default;
        }

        /* --- CSS CHO TUY·∫æT R∆†I --- */
        .snowflake {
            position: fixed;
            top: -50px; 
            left: 0;
            
            background-color: #fff;
            border-radius: 50%;
            width: 5px;
            height: 5px;
            
            z-index: 9999;
            pointer-events: none;
            
            /* Animation */
            animation-name: fall, shake;
            animation-duration: 10s, 3s;
            animation-timing-function: linear, ease-in-out;
            animation-iteration-count: infinite, infinite;
            
            animation-fill-mode: both; 
        }

        @keyframes fall { 
            0% { top: -50px; }
            100% { top: 110vh; }
        }

        @keyframes shake {
            0% { transform: translateX(0px); }
            50% { transform: translateX(20px); } 
            100% { transform: translateX(0px); }
        }

        /* --- M√ÄN H√åNH CH·ªú (OPENING) --- */
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), url("opening.jpg");
            background-size: cover; background-position: 50% 20%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 9999; color: white; cursor: none; transition: opacity 1s;
        }
        .shake-icon {
            font-size: 6rem; margin-bottom: 10px; animation: shake-box 2s infinite ease-in-out;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }
        @keyframes shake-box {
            0% { transform: rotate(0deg) scale(1); } 25% { transform: rotate(10deg) scale(1.1); }
            50% { transform: rotate(0deg) scale(1); } 75% { transform: rotate(-10deg) scale(1.1); }
            100% { transform: rotate(0deg) scale(1); }
        }
        #start-overlay h2 { font-size: 2.5rem; text-shadow: 0 0 10px white; animation: pulse 1.5s infinite; margin: 0 0 5px 0; }
        #start-overlay p { font-size: 1rem; opacity: 0.8; margin: 0; }
        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }

        /* --- BACKGROUND --- */
        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: -1; }
        .moon {
            position: fixed; top: 10%; right: 15%; width: 100px; height: 100px;
            background: #fdfd96; border-radius: 50%; box-shadow: 0 0 40px #fdfd96, 0 0 80px #fff;
            z-index: 0; opacity: 0.9; pointer-events: none;
        }
        .santa-container {
            position: fixed; top: 15%; left: -30%; width: 300px; z-index: 2; opacity: 0.9; pointer-events: none;
            animation: flyAcross 25s linear infinite; animation-delay: 2s;
        }
        .santa-container img { filter: brightness(75%); }
        @keyframes flyAcross {
            0% { left: -30%; transform: translateY(0) rotate(-5deg); }
            25% { transform: translateY(-20px) rotate(0deg); }
            50% { transform: translateY(0) rotate(5deg); }
            75% { transform: translateY(-20px) rotate(0deg); }
            100% { left: 120%; transform: translateY(0) rotate(-5deg); }
        }

        /* --- MAIN CONTENT --- */
        #header-title {
            position: fixed; top: 30px; width: 100%; text-align: center; z-index: 10; pointer-events: none;
            opacity: 0; transition: opacity 2s;
        }
        h1 {
            font-size: 5rem; margin: 0; font-weight: 700;
            background: linear-gradient(to bottom, #ff0000, #ffcc00, #00ff00);
            -webkit-background-clip: text; background-clip: text; color: transparent;
            text-shadow: 0 0 20px rgba(255, 0, 0, 0.5); animation: glow 2s infinite alternate;
        }
        @keyframes glow {
            from { text-shadow: 0 0 10px rgba(255, 255, 255, 0.3); }
            to { text-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 10px white; }
        }
        .spacer { height: 100vh; width: 100%; }
        .gift-section {
            min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: linear-gradient(to top, #000000 0%, transparent 100%); padding-bottom: 50px;
        }
        .gift-title { color: white; font-size: 2.5rem; margin-bottom: 160px; text-shadow: 0 0 10px #fff; }
        .gift-container { display: flex; gap: 150px; flex-wrap: wrap; justify-content: center; }
        .gift-box { position: relative; width: 150px; height: 150px; cursor: pointer; transition: transform 0.3s; perspective: 1000px; z-index: 5;} /* TƒÉng z-index ƒë·ªÉ n·ªïi tr√™n tuy·∫øt */
        .gift-box:hover { transform: translateY(-10px); }
        .box-body { width: 100%; height: 100%; background-color: #d32f2f; border-radius: 10px; position: relative; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .gift-box:nth-child(2) .box-body { background-color: #1b5e20; }
        .gift-box:nth-child(3) .box-body { background-color: #0d47a1; }
        .box-lid { width: 110%; height: 40px; background-color: #b71c1c; position: absolute; top: -10px; left: -5%; border-radius: 5px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); transition: transform 0.5s ease-in-out, top 0.5s ease-in-out; z-index: 2; }
        .gift-box:nth-child(2) .box-lid { background-color: #0d3b14; }
        .gift-box:nth-child(3) .box-lid { background-color: #072d6b; }
        .ribbon-vertical { position: absolute; width: 20px; height: 100%; background: #ffeb3b; left: 50%; transform: translateX(-50%); }
        .ribbon-horizontal { position: absolute; height: 20px; width: 100%; background: #ffeb3b; top: 50%; transform: translateY(-50%); }
        .lid-ribbon { position: absolute; width: 20px; height: 100%; background: #ffeb3b; left: 50%; transform: translateX(-50%); }
        .gift-box.opened .box-lid { transform: rotate(-30deg) translateY(-20px) translateX(10px); top: -60px; }

        /* CSS cho wish-content */
        .wish-content { 
            position: absolute; bottom: 0; left: 50%; transform: translateX(-50%) scale(0); 
            width: 200px;
            background: white; color: #333; padding: 15px; border-radius: 10px; 
            text-align: center; font-size: 1.1rem; opacity: 0; 
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            z-index: 5; pointer-events: none; box-shadow: 0 5px 15px rgba(255,255,255,0.2); 
            font-family: Arial, sans-serif; 
            min-height: 50px;
            display: flex; align-items: center; justify-content: center;
        }
        .wish-content::after { content: ''; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); border-width: 10px 10px 0; border-style: solid; border-color: white transparent transparent transparent; }
        .gift-box.opened .wish-content { transform: translateX(-50%) scale(1) translateY(-170px); opacity: 1; }

        @media (max-width: 768px) { 
            h1 { font-size: 3rem; } 
            .gift-container { flex-direction: column; } 
            .santa-container { width: 150px; top: 12%; } 
            .moon { width: 60px; height: 60px; top: 8%; right: 10%; } 
        }
    </style>
</head>
<body onselectstart="return false">
    <audio id="bg-music" loop>
        <source src="christmas1.mp3" type="audio/mp3">
    </audio>
    <audio id="hohoho-sfx">
        <source src="hohoho.mp3" type="audio/mp3">
    </audio>

    <div id="start-overlay" onclick="startExperience()">
        <div class="shake-icon">üéÅ</div>
        <h2>Gently open me...</h2>
    </div>

    <div class="moon"></div>
    <div class="santa-container">
        <img src="santa.png" width="100%" alt="Santa flying">
    </div>
    <div id="snow-container"></div>

    <div id="canvas-container"></div>
    <div id="header-title"><h1>MERRY CHRISTMAS</h1></div>
    <div class="spacer"></div>

    <div class="gift-section">
        <div class="gift-title">Gifts just for ya mah love!!! üéÅ</div>
        <div class="gift-container">
            <div class="gift-box" onclick="toggleGift(this)">
                <div class="wish-content" data-text="Ch√∫c t√¨nh y√™u c·ªßa t·ªõ ƒë·∫πp ngh√¨n nƒÉm nh∆∞ m√πa thu H√† N·ªôi. üçÇ"></div>
                <div class="box-lid"><div class="lid-ribbon"></div></div>
                <div class="box-body"><div class="ribbon-vertical"></div><div class="ribbon-horizontal"></div></div>
            </div>
            <div class="gift-box" onclick="toggleGift(this)">
                <div class="wish-content" data-text="Ch√∫c t·ªõ s·ªõm ph√°t t√†i ph√°t l·ªôc, vinh quy b√°i t·ªï, r∆∞·ªõc c·∫≠u v·ªÅ l√¢u ƒë√†i mang t√™n t√¨nh √°i. üíò"></div>
                <div class="box-lid"><div class="lid-ribbon"></div></div>
                <div class="box-body"><div class="ribbon-vertical"></div><div class="ribbon-horizontal"></div></div>
            </div>
            <div class="gift-box" onclick="toggleGift(this)">
                <div class="wish-content" data-text="Gi√°ng sinh an l√†nh. Mong m·ªçi ƒëi·ªÅu t·ªët ƒë·∫πp nh·∫•t s·∫Ω ƒë·∫øn v·ªõi c·∫≠u (v√† t·ªõ). üéÑ"></div>
                <div class="box-lid"><div class="lid-ribbon"></div></div>
                <div class="box-body"><div class="ribbon-vertical"></div><div class="ribbon-horizontal"></div></div>
            </div>
        </div>
    </div>

    <script type="importmap">{ "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }</script>

    <script type="module">
        import * as THREE from 'three';

        // --- 1. T·∫†O TUY·∫æT R∆†I D√ÄY ƒê·∫∂C ---
        function createSnowflakes() {
            const snowContainer = document.getElementById('snow-container');
            const numberOfSnowflakes = 100; 

            for (let i = 0; i < numberOfSnowflakes; i++) {
                const snowflake = document.createElement('div');
                snowflake.classList.add('snowflake');
                
                // Random v·ªã tr√≠ v√† t·ªëc ƒë·ªô
                snowflake.style.left = Math.random() * 100 + 'vw';
                snowflake.style.animationDuration = Math.random() * 5 + 5 + 's'; 
                snowflake.style.animationDelay = Math.random() * 5 + 's'; 
                snowflake.style.opacity = Math.random() * 0.7 + 0.3; 
                snowflake.style.width = Math.random() * 7 + 3 + 'px'; // Size to nh·ªè kh√°c nhau
                snowflake.style.height = snowflake.style.width; // Gi·ªØ h√¨nh tr√≤n

                snowContainer.appendChild(snowflake);
            }
        }
        createSnowflakes();

        // --- 2. H√ÄM G√ï M√ÅY CH·ªÆ ---
        function typeWriter(element, text, speed) {
            let i = 0;
            element.innerHTML = ""; 
            function type() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                }
            }
            type();
        }

        // --- C√ÅC PH·∫¶N LOGIC KH√ÅC ---
        let isStarted = false;
        let startTime = 0;

        window.startExperience = function() {
            const overlay = document.getElementById('start-overlay');
            const bgMusic = document.getElementById('bg-music');
            const hohohoSfx = document.getElementById('hohoho-sfx'); 
            const title = document.getElementById('header-title');
            
            bgMusic.volume = 1.0;
            bgMusic.play().catch(e => console.log("Browser ch·∫∑n autoplay"));
            
            hohohoSfx.volume = 0.5; 
            hohohoSfx.currentTime = 0; 
            hohohoSfx.play().catch(e => console.log("Browser ch·∫∑n autoplay sfx"));

            overlay.style.opacity = '0';
            setTimeout(() => overlay.remove(), 1000);
            
            isStarted = true;
            startTime = Date.now();
            title.style.opacity = '1';
        }

        // Three.js Setup
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x000000, 0.002);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 25; camera.position.y = 0; camera.lookAt(0, 0, 0);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        container.appendChild(renderer.domElement);

        function createStarTexture() {
            const canvas = document.createElement('canvas'); canvas.width = 128; canvas.height = 128;
            const ctx = canvas.getContext('2d');
            const cx = 64, cy = 64, outerRadius = 40, innerRadius = 20;
            let rot = Math.PI / 2 * 3, x = cx, y = cy, step = Math.PI / 5;
            ctx.beginPath(); ctx.moveTo(cx, cy - outerRadius);
            for (let i = 0; i < 5; i++) {
                x = cx + Math.cos(rot) * outerRadius; y = cy + Math.sin(rot) * outerRadius; ctx.lineTo(x, y); rot += step;
                x = cx + Math.cos(rot) * innerRadius; y = cy + Math.sin(rot) * innerRadius; ctx.lineTo(x, y); rot += step;
            }
            ctx.lineTo(cx, cy - outerRadius); ctx.closePath();
            ctx.fillStyle = "#FFFF00"; ctx.shadowColor = "#FFFF00"; ctx.shadowBlur = 10; ctx.fill();
            return new THREE.CanvasTexture(canvas);
        }

        const particleCount = 12000;
        const geometry = new THREE.BufferGeometry();
        const positions = []; const colors = []; const speeds = []; const targetPositions = [];
        const colorPalette = [new THREE.Color('#00ff00'), new THREE.Color('#7cfc00'), new THREE.Color('#ffffff'), new THREE.Color('#ff0000'), new THREE.Color('#ffd700')];
        for (let i = 0; i < particleCount; i++) {
            const y = -15 + Math.random() * 25; 
            const radius = (12 - (y + 15) * 0.48) * Math.sqrt(Math.random()); 
            const theta = Math.random() * Math.PI * 2;
            targetPositions.push(radius * Math.cos(theta), y, radius * Math.sin(theta));
            positions.push((Math.random()-0.5)*120, (Math.random()-0.5)*120, (Math.random()-0.5)*120);
            const color = colorPalette[Math.floor(Math.random() * colorPalette.length)];
            colors.push(color.r, color.g, color.b);
            speeds.push(Math.random());
        }
        geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
        geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

        const getDotTexture = () => {
            const canvas = document.createElement('canvas'); canvas.width = 32; canvas.height = 32;
            const ctx = canvas.getContext('2d');
            const grad = ctx.createRadialGradient(16,16,0,16,16,16);
            grad.addColorStop(0, 'rgba(255,255,255,1)'); grad.addColorStop(1, 'rgba(0,0,0,0)');
            ctx.fillStyle = grad; ctx.fillRect(0,0,32,32);
            return new THREE.CanvasTexture(canvas);
        }
        const material = new THREE.PointsMaterial({ size: 0.25, vertexColors: true, blending: THREE.AdditiveBlending, depthWrite: false, transparent: true, opacity: 0.9, map: getDotTexture() });
        const particles = new THREE.Points(geometry, material);
        scene.add(particles);

        const starMaterial = new THREE.SpriteMaterial({ map: createStarTexture(), color: 0xffffff, blending: THREE.AdditiveBlending, opacity: 0 });
        const star = new THREE.Sprite(starMaterial); star.scale.set(3, 3, 1); star.position.set(0, 10.8, 0); scene.add(star);
        const haloMaterial = new THREE.SpriteMaterial({ map: getDotTexture(), color: 0xffd700, blending: THREE.AdditiveBlending, opacity: 0 });
        const halo = new THREE.Sprite(haloMaterial); halo.scale.set(8, 8, 1); halo.position.set(0, 11, 0); scene.add(halo);

        function animate() {
            requestAnimationFrame(animate);
            if (!isStarted) return;
            const elapsed = (Date.now() - startTime) / 1000;
            particles.rotation.y = elapsed * 0.15;
            const pos = particles.geometry.attributes.position.array;
            for (let i = 0; i < particleCount; i++) {
                const i3 = i * 3;
                pos[i3] += (targetPositions[i3] - pos[i3]) * 0.02 * speeds[i];
                pos[i3+1] += (targetPositions[i3+1] - pos[i3+1]) * 0.02 * speeds[i];
                pos[i3+2] += (targetPositions[i3+2] - pos[i3+2]) * 0.02 * speeds[i];
                if (Math.abs(pos[i3] - targetPositions[i3]) < 0.5) { pos[i3] += Math.sin(elapsed * 3 + i) * 0.015; pos[i3+1] += Math.cos(elapsed * 2 + i) * 0.015; }
            }
            if (elapsed > 5.0) { if(star.material.opacity < 1) star.material.opacity += 0.02; if(halo.material.opacity < 0.8) halo.material.opacity += 0.02; }
            particles.geometry.attributes.position.needsUpdate = true;
            renderer.render(scene, camera);
        }
        animate();
        window.addEventListener('resize', () => { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });

        // --- X·ª¨ L√ù M·ªû QU√Ä + G√ï CH·ªÆ ---
        window.toggleGift = function(element) {
            if (!element.classList.contains('opened')) {
                element.classList.add('opened');
                
                const sfx = document.getElementById('hohoho-sfx');
                sfx.pause(); sfx.currentTime = 0; 
                sfx.play().catch(e => console.log("L·ªói ph√°t nh·∫°c:", e)); 

                // G√µ ch·ªØ
                const wishContent = element.querySelector('.wish-content');
                if (wishContent && !wishContent.dataset.typed) {
                    const textToType = wishContent.dataset.text; 
                    typeWriter(wishContent, textToType, 50); // T·ªëc ƒë·ªô 50ms
                    wishContent.dataset.typed = "true";
                }

                const rect = element.getBoundingClientRect();
                const x = (rect.left + rect.width / 2) / window.innerWidth;
                const y = (rect.top + rect.height / 2) / window.innerHeight;
                confetti({ particleCount: 100, spread: 70, origin: { x: x, y: y }, colors: ['#ff0000', '#00ff00', '#ffff00', '#ffffff'], zIndex: 9999 });
            } else {
                element.classList.remove('opened');
            }
        }
    </script>
</body>
</html>